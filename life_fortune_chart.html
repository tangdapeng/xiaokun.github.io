<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人生运势曲线图</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        #vis {
            width: 100%;
            height: 400px;
            min-width: 800px;
            overflow-x: auto;
        }
        
        .chart-container {
            width: 100%;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        @media (max-width: 768px) {
            #vis {
                height: 350px;
                min-width: 1000px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .subtitle {
                font-size: 1em;
            }
            
            .legend-info {
                padding: 10px;
            }
            
            .rating-scale {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .rating-item {
                flex: 0 0 calc(50% - 5px);
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            #vis {
                height: 300px;
                min-width: 1200px;
            }
            
            .rating-item {
                flex: 0 0 100%;
                margin-bottom: 8px;
            }
        }
        .legend-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .legend-info h3 {
            margin-top: 0;
            color: #333;
        }
        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .rating-item {
            text-align: center;
            flex: 1;
        }
        .rating-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto 5px;
        }
        .positive { background-color: #d32f2f; }
        .negative { background-color: #388e3c; }
        
        .mobile-hint {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            text-align: center;
            color: #1976d2;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>人生运势曲线图</h1>
        <p class="subtitle">综合大运基调与流年影响 (7-90岁)</p>
        
        <div class="chart-container">
            <div class="mobile-hint" id="mobileHint" style="display: none;">
                <p>📱 在移动设备上，您可以左右滑动查看完整图表</p>
            </div>
            <div id="vis"></div>
        </div>
        
        <div class="legend-info">
            <h3>运势评级说明</h3>
            <div class="rating-scale">
                <div class="rating-item">
                    <div class="rating-color positive"></div>
                    <div>5分 - 极佳</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color positive"></div>
                    <div>3分 - 良好</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color positive"></div>
                    <div>1分 - 一般</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color positive"></div>
                    <div>0分 - 平稳</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color negative"></div>
                    <div>-1分 - 稍差</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color negative"></div>
                    <div>-3分 - 较差</div>
                </div>
                <div class="rating-item">
                    <div class="rating-color negative"></div>
                    <div>-5分 - 极差</div>
                </div>
            </div>
            <p><strong>注意：</strong> 2025年（30岁）为人生重要关口，需要特别关注。2062-2067年（68-72岁）为人生巅峰期。</p>
        </div>
    </div>

    <script>
        const spec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": {
                "text": "人生运势曲线图 (7-90岁)",
                "subtitle": "综合大运基调与流年影响"
            },
            "width": 1200,
            "height": 400,
            "data": {
                "values": [
                    {"年份": 2002, "年龄": 7, "大运": "戊子 (7-17岁)", "评级": 2, "事件": "壬午: 水火相济, 运势启动"},
                    {"年份": 2003, "年龄": 8, "大运": "戊子 (7-17岁)", "评级": -1, "事件": "癸未: 丑未冲, 初见波动"},
                    {"年份": 2004, "年龄": 9, "大运": "戊子 (7-17岁)", "评级": -2, "事件": "甲申: 官来合身, 压力初显"},
                    {"年份": 2005, "年龄": 10, "大运": "戊子 (7-17岁)", "评级": -3, "事件": "乙酉: 杀星会局, 挑战增多"},
                    {"年份": 2006, "年龄": 11, "大运": "戊子 (7-17岁)", "评级": 1, "事件": "丙戌: 火来暖局, 稍有缓和"},
                    {"年份": 2007, "年龄": 12, "大运": "戊子 (7-17岁)", "评级": 2, "事件": "丁亥: 水火皆喜, 顺心如意"},
                    {"年份": 2008, "年龄": 13, "大运": "戊子 (7-17岁)", "评级": -2, "事件": "戊子: 财星重叠, 压力增加"},
                    {"年份": 2009, "年龄": 14, "大运": "戊子 (7-17岁)", "评级": -3, "事件": "己丑: 财星通根, 颇为不顺"},
                    {"年份": 2010, "年龄": 15, "大运": "戊子 (7-17岁)", "评级": 0, "事件": "庚寅: 官印相生, 遇贵解厄"},
                    {"年份": 2011, "年龄": 16, "大运": "戊子 (7-17岁)", "评级": 0, "事件": "辛卯: 杀印相生, 压力与助力并存"},
                    {"年份": 2012, "年龄": 17, "大运": "丁亥 (18-27岁)", "评级": 1, "事件": "壬辰: 换运初期, 尚有波动"},
                    {"年份": 2013, "年龄": 18, "大运": "丁亥 (18-27岁)", "评级": 5, "事件": "癸巳: 水火相济, 运势强劲"},
                    {"年份": 2014, "年龄": 19, "大运": "丁亥 (18-27岁)", "评级": 5, "事件": "甲午: 木火通明, 春风得意"},
                    {"年份": 2015, "年龄": 20, "大运": "丁亥 (18-27岁)", "评级": 1, "事件": "乙未: 丑未冲, 渐生阻力"},
                    {"年份": 2016, "年龄": 21, "大运": "丁亥 (18-27岁)", "评级": 0, "事件": "丙申: 官来合身, 内藏压力"},
                    {"年份": 2017, "年龄": 22, "大运": "丁亥 (18-27岁)", "评级": -1, "事件": "丁酉: 杀星会局, 压力渐显"},
                    {"年份": 2018, "年龄": 23, "大运": "丁亥 (18-27岁)", "评级": -2, "事件": "戊戌: 财星破印, 运势转折"},
                    {"年份": 2019, "年龄": 24, "大运": "丁亥 (18-27岁)", "评级": 3, "事件": "己亥: 水木相助, 稍有缓和"},
                    {"年份": 2020, "年龄": 25, "大运": "丁亥 (18-27岁)", "评级": 1, "事件": "庚子: 官印相生, 遇贵解厄"},
                    {"年份": 2021, "年龄": 26, "大运": "丁亥 (18-27岁)", "评级": -2, "事件": "辛丑: 杀星通根, 压力巨大"},
                    {"年份": 2022, "年龄": 27, "大运": "丙戌 (28-37岁)", "评级": 2, "事件": "壬寅: 换运之年, 承接好运"},
                    {"年份": 2023, "年龄": 28, "大运": "丙戌 (28-37岁)", "评级": 1, "事件": "癸卯: 水木相生, 开局尚可"},
                    {"年份": 2024, "年龄": 29, "大运": "丙戌 (28-37岁)", "评级": -2, "事件": "甲辰: 财星增力, 危机酝酿"},
                    {"年份": 2025, "年龄": 30, "大运": "丙戌 (28-37岁)", "评级": -5, "事件": "乙巳: 【人生重要关口】三合杀局, 动荡之极"},
                    {"年份": 2026, "年龄": 31, "大运": "丙戌 (28-37岁)", "评级": 2, "事件": "丙午: 【重要转折点】火神解困, 绝地反击"},
                    {"年份": 2027, "年龄": 32, "大运": "丙戌 (28-37岁)", "评级": -1, "事件": "丁未: 丑未冲, 运势回稳但仍有动荡"},
                    {"年份": 2028, "年龄": 33, "大运": "丙戌 (28-37岁)", "评级": -4, "事件": "戊申: 财官相生, 压力重来"},
                    {"年份": 2029, "年龄": 34, "大运": "丙戌 (28-37岁)", "评级": -5, "事件": "己酉: 财杀相生, 困难持续"},
                    {"年份": 2030, "年龄": 35, "大运": "丙戌 (28-37岁)", "评级": -5, "事件": "庚戌: 丑戌刑, 大运内最差年份, 动荡不安"},
                    {"年份": 2031, "年龄": 36, "大运": "丙戌 (28-37岁)", "评级": -2, "事件": "辛亥: 杀印相生, 谷底回弹"},
                    {"年份": 2032, "年龄": 37, "大运": "乙酉 (38-47岁)", "评级": 0, "事件": "壬子: 换运之年, 强力回升"},
                    {"年份": 2033, "年龄": 38, "大运": "乙酉 (38-47岁)", "评级": -3, "事件": "癸丑: 杀星得地, 压力仍在"},
                    {"年份": 2034, "年龄": 39, "大运": "乙酉 (38-47岁)", "评级": 0, "事件": "甲寅: 比劫帮身, 难得喘息"},
                    {"年份": 2035, "年龄": 40, "大运": "乙酉 (38-47岁)", "评级": 0, "事件": "乙卯: 比肩分担, 稍有助力"},
                    {"年份": 2036, "年龄": 41, "大运": "乙酉 (38-47岁)", "评级": -1, "事件": "丙辰: 喜忧参半, 好运渐退"},
                    {"年份": 2037, "年龄": 42, "大运": "乙酉 (38-47岁)", "评级": 1, "事件": "丁巳: 火来制金, 大运内最佳年份, 可解困"},
                    {"年份": 2038, "年龄": 43, "大运": "乙酉 (38-47岁)", "评级": -2, "事件": "戊午: 吉凶参半, 内心矛盾"},
                    {"年份": 2039, "年龄": 44, "大运": "乙酉 (38-47岁)", "评级": -5, "事件": "己未: 丑未冲, 运势再次走低"},
                    {"年份": 2040, "年龄": 45, "大运": "乙酉 (38-47岁)", "评级": -5, "事件": "庚申: 官杀混杂, 大运内最差年份, 压力顶峰"},
                    {"年份": 2041, "年龄": 46, "大运": "乙酉 (38-47岁)", "评级": -5, "事件": "辛酉: 七杀重重, 极力隐忍"},
                    {"年份": 2042, "年龄": 47, "大运": "甲申 (48-57岁)", "评级": -1, "事件": "壬戌: 换运之年, 稍有缓和"},
                    {"年份": 2043, "年龄": 48, "大运": "甲申 (48-57岁)", "评级": -1, "事件": "癸亥: 水木相生, 运势回暖"},
                    {"年份": 2044, "年龄": 49, "大运": "甲申 (48-57岁)", "评级": -3, "事件": "甲子: 喜忧参半, 仍有压力"},
                    {"年份": 2045, "年龄": 50, "大运": "甲申 (48-57岁)", "评级": -4, "事件": "乙丑: 杀星得地, 阻碍重重"},
                    {"年份": 2046, "年龄": 51, "大运": "甲申 (48-57岁)", "评级": 1, "事件": "丙寅: 木火相生, 难得顺境"},
                    {"年份": 2047, "年龄": 52, "大运": "甲申 (48-57岁)", "评级": 1, "事件": "丁卯: 食神制杀, 事业有成"},
                    {"年份": 2048, "年龄": 53, "大运": "甲申 (48-57岁)", "评级": -3, "事件": "戊辰: 财星增力, 压力再起"},
                    {"年份": 2049, "年龄": 54, "大运": "甲申 (48-57岁)", "评级": -1, "事件": "己巳: 火土相生, 尚可平稳"},
                    {"年份": 2050, "年龄": 55, "大运": "甲申 (48-57岁)", "评级": -2, "事件": "庚午: 官星得禄, 挑战与机遇并存"},
                    {"年份": 2051, "年龄": 56, "大运": "甲申 (48-57岁)", "评级": -4, "事件": "辛未: 丑未冲, 动荡不安"},
                    {"年份": 2052, "年龄": 57, "大运": "癸未 (58-67岁)", "评级": 1, "事件": "壬申: 换运之年, 运势回升"},
                    {"年份": 2053, "年龄": 58, "大运": "癸未 (58-67岁)", "评级": 0, "事件": "癸酉: 杀印相生, 压力仍在"},
                    {"年份": 2054, "年龄": 59, "大运": "癸未 (58-67岁)", "评级": 3, "事件": "甲戌: 丑戌刑, 但劫财帮身有力"},
                    {"年份": 2055, "年龄": 60, "大运": "癸未 (58-67岁)", "评级": 3, "事件": "乙亥: 水木相生, 渐入佳境"},
                    {"年份": 2056, "年龄": 61, "大运": "癸未 (58-67岁)", "评级": 3, "事件": "丙子: 水火既济, 事业顺心"},
                    {"年份": 2057, "年龄": 62, "大运": "癸未 (58-67岁)", "评级": 2, "事件": "丁丑: 食神驾杀, 尚有可为"},
                    {"年份": 2058, "年龄": 63, "大运": "癸未 (58-67岁)", "评级": 0, "事件": "戊寅: 财星破印, 稍有不顺"},
                    {"年份": 2059, "年龄": 64, "大运": "癸未 (58-67岁)", "评级": 0, "事件": "己卯: 财星破印, 同上"},
                    {"年份": 2060, "年龄": 65, "大运": "癸未 (58-67岁)", "评级": -1, "事件": "庚辰: 官星增力, 需防是非"},
                    {"年份": 2061, "年龄": 66, "大运": "癸未 (58-67岁)", "评级": 2, "事件": "辛巳: 火来制金, 运势回稳"},
                    {"年份": 2062, "年龄": 67, "大运": "壬午 (68-77岁)", "评级": 5, "事件": "壬午: 换运之年, 步入人生巅峰"},
                    {"年份": 2063, "年龄": 68, "大运": "壬午 (68-77岁)", "评级": 3, "事件": "癸未: 丑未冲, 但大运强劲无碍"},
                    {"年份": 2064, "年龄": 69, "大运": "壬午 (68-77岁)", "评级": 5, "事件": "甲申: 虽有金扰, 但水木火势强"},
                    {"年份": 2065, "年龄": 70, "大运": "壬午 (68-77岁)", "评级": 5, "事件": "乙酉: 同上, 运强不惧流年之克"},
                    {"年份": 2066, "年龄": 71, "大运": "壬午 (68-77岁)", "评级": 5, "事件": "丙戌: 火土相生, 福禄绵长"},
                    {"年份": 2067, "年龄": 72, "大运": "壬午 (68-77岁)", "评级": 5, "事件": "丁亥: 水火既济, 万事顺遂"},
                    {"年份": 2068, "年龄": 73, "大运": "壬午 (68-77岁)", "评级": 2, "事件": "戊子: 财星破印, 需防破耗"},
                    {"年份": 2069, "年龄": 74, "大运": "壬午 (68-77岁)", "评级": 2, "事件": "己丑: 财星破印, 同上"},
                    {"年份": 2070, "年龄": 75, "大运": "壬午 (68-77岁)", "评级": 3, "事件": "庚寅: 官印相生, 名利双收"},
                    {"年份": 2071, "年龄": 76, "大运": "壬午 (68-77岁)", "评级": 3, "事件": "辛卯: 杀印相生, 权柄在握"},
                    {"年份": 2072, "年龄": 77, "大运": "辛巳 (78-87岁)", "评级": 1, "事件": "壬辰: 换运之年, 运势平稳"},
                    {"年份": 2073, "年龄": 78, "大运": "辛巳 (78-87岁)", "评级": 3, "事件": "癸巳: 水火相济, 安享福泽"},
                    {"年份": 2074, "年龄": 79, "大运": "辛巳 (78-87岁)", "评级": 4, "事件": "甲午: 木火通明, 身心康泰"},
                    {"年份": 2075, "年龄": 80, "大运": "辛巳 (78-87岁)", "评级": 0, "事件": "乙未: 丑未冲, 需防健康波动"},
                    {"年份": 2076, "年龄": 81, "大运": "辛巳 (78-87岁)", "评级": -1, "事件": "丙申: 官星合身, 稍有烦扰"},
                    {"年份": 2077, "年龄": 82, "大运": "辛巳 (78-87岁)", "评级": 0, "事件": "丁酉: 食神制杀, 平安是福"},
                    {"年份": 2078, "年龄": 83, "大运": "辛巳 (78-87岁)", "评级": -2, "事件": "戊戌: 丑戌刑, 需防是非"},
                    {"年份": 2079, "年龄": 84, "大运": "辛巳 (78-87岁)", "评级": 2, "事件": "己亥: 水来润局, 运势回稳"},
                    {"年份": 2080, "年龄": 85, "大运": "辛巳 (78-87岁)", "评级": -1, "事件": "庚子: 官印相生, 喜忧参半"},
                    {"年份": 2081, "年龄": 86, "大运": "辛巳 (78-87岁)", "评级": -3, "事件": "辛丑: 杀星通根, 需保重身体"},
                    {"年份": 2082, "年龄": 87, "大运": "庚辰 (88-97岁)", "评级": 0, "事件": "壬寅: 换运之年, 水木相生"},
                    {"年份": 2083, "年龄": 88, "大运": "庚辰 (88-97岁)", "评级": 0, "事件": "癸卯: 水木相生, 尚可安康"},
                    {"年份": 2084, "年龄": 89, "大运": "庚辰 (88-97岁)", "评级": -2, "事件": "甲辰: 财星重重, 运势走低"},
                    {"年份": 2085, "年龄": 90, "大运": "庚辰 (88-97岁)", "评级": -1, "事件": "乙巳: 火来暖局, 稍有慰藉"}
                ]
            },
            "encoding": {
                "x": {
                    "field": "年份",
                    "type": "ordinal",
                    "title": "年份 (流年)",
                    "axis": {
                        "labelAngle": -45, 
                        "labelFontSize": 10,
                        "labelLimit": 50,
                        "tickCount": 20
                    }
                },
                "tooltip": [
                    {"field": "年份", "type": "ordinal", "title": "年份"},
                    {"field": "年龄", "type": "quantitative", "title": "年龄"},
                    {"field": "大运", "type": "nominal", "title": "大运阶段"},
                    {"field": "评级", "type": "quantitative", "title": "运势评级"},
                    {"field": "事件", "type": "nominal", "title": "简评"}
                ]
            },
            "layer": [
                {
                    "mark": {
                        "type": "rect",
                        "opacity": 0.15
                    },
                    "encoding": {
                        "color": {
                            "field": "大运",
                            "type": "nominal",
                            "title": "大运阶段",
                            "legend": {"orient": "top", "columns": 3, "labelFontSize": 10}
                        }
                    }
                },
                {
                    "mark": {
                        "type": "line",
                        "point": {
                            "filled": true,
                            "stroke": "white",
                            "strokeWidth": 2
                        },
                        "interpolate": "monotone",
                        "strokeWidth": 3
                    },
                    "encoding": {
                        "y": {
                            "field": "评级",
                            "type": "quantitative",
                            "title": "吉凶评级",
                            "scale": {"domain": [-5, 5]},
                            "axis": {"grid": true}
                        },
                        "color": {
                            "condition": {
                                "test": "datum.评级 >= 0",
                                "value": "#d32f2f"
                            },
                            "value": "#388e3c"
                        },
                        "size": {
                            "condition": {
                                "test": "datum.年份 == 2025",
                                "value": 5
                            },
                            "value": 3
                        }
                    }
                },
                {
                    "mark": {
                        "type": "rule",
                        "stroke": "#ff4444",
                        "strokeWidth": 3,
                        "strokeDash": [5, 5]
                    },
                    "transform": [
                        {"filter": "datum.年份 == 2025"}
                    ]
                },
                {
                    "mark": {
                        "type": "text",
                        "align": "left",
                        "dx": 10,
                        "dy": -15,
                        "fontSize": 14,
                        "fontWeight": "bold",
                        "color": "#ff4444"
                    },
                    "transform": [
                        {"filter": "datum.年份 == 2025"},
                        {"calculate": "'⚠️ 当前年份 - 人生重要关口'", "as": "label"}
                    ],
                    "encoding": {
                        "text": {"field": "label"}
                    }
                },
                {
                    "mark": {
                        "type": "rule",
                        "stroke": "#44aa44",
                        "strokeWidth": 2,
                        "strokeDash": [3, 3]
                    },
                    "transform": [
                        {"filter": "datum.年份 >= 2062 && datum.年份 <= 2067"}
                    ]
                },
                {
                    "mark": {
                        "type": "text",
                        "align": "left",
                        "dx": 10,
                        "dy": 20,
                        "fontSize": 12,
                        "fontWeight": "bold",
                        "color": "#44aa44"
                    },
                    "transform": [
                        {"filter": "datum.年份 == 2062"},
                        {"calculate": "'🌟 人生巅峰期'", "as": "label"}
                    ],
                    "encoding": {
                        "text": {"field": "label"}
                    }
                }
            ]
        };

        // 检测移动设备
        function isMobile() {
            return window.innerWidth <= 768;
        }
        
        // 显示移动端提示
        if (isMobile()) {
            document.getElementById('mobileHint').style.display = 'block';
        }
        
        // 监听窗口大小变化
        window.addEventListener('resize', function() {
            if (isMobile()) {
                document.getElementById('mobileHint').style.display = 'block';
            } else {
                document.getElementById('mobileHint').style.display = 'none';
            }
        });

        vegaEmbed('#vis', spec, {
            actions: false,
            renderer: 'svg'
        }).then(function(result) {
            console.log('图表渲染完成');
        }).catch(console.error);
    </script>
</body>
</html>
